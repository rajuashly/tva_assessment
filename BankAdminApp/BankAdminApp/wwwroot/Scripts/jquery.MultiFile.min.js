window.jQuery&&function(n){"use strict";function t(n){return n>1048576?(n/1048576).toFixed(1)+"Mb":n==1024?"1Mb":(n/1024).toFixed(1)+"Kb"}function i(n){return(n.files&&n.files.length?n.files:null)||[{name:n.value,size:0,type:((n.value||"").match(/[^\.]+$/i)||[""])[0]}]}n.fn.MultiFile=function(r){var u,r;if(this.length==0)return this;if(typeof arguments[0]=="string")return this.length>1?(u=arguments,this.each(function(){n.fn.MultiFile.apply(n(this),u)})):n.fn.MultiFile[arguments[0]].apply(this,n.makeArray(arguments).slice(1)||[]);typeof r=="number"&&(r={max:r});r=n.extend({},n.fn.MultiFile.options,r||{});n("form").not("MultiFile-intercepted").addClass("MultiFile-intercepted").submit(n.fn.MultiFile.disableEmpty);n.fn.MultiFile.options.autoIntercept&&(n.fn.MultiFile.intercept(n.fn.MultiFile.options.autoIntercept),n.fn.MultiFile.options.autoIntercept=null);this.not(".MultiFile-applied").addClass("MultiFile-applied").each(function(){window.MultiFile=(window.MultiFile||0)+1;var e=window.MultiFile,u={e:this,E:n(this),clone:n(this).clone()},f=n.extend({},n.fn.MultiFile.options,r||{},(n.metadata?u.E.metadata():n.meta?u.E.data():null)||{},{});f.max>0||(f.max=u.E.attr("maxlength"));f.max>0||(f.max=(String(u.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],f.max=f.max>0?String(f.max).match(/[0-9]+/gi)[0]:-1);f.max=new Number(f.max);f.accept=f.accept||u.E.attr("accept")||"";f.accept||(f.accept=u.e.className.match(/\b(accept\-[\w\|]+)\b/gi)||"",f.accept=new String(f.accept).replace(/^(accept|ext)\-/i,""));f.maxsize=f.maxsize>0?f.maxsize:null||u.E.data("maxsize")||0;f.maxsize>0||(f.maxsize=(String(u.e.className.match(/\b(maxsize|maxload|size)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],f.maxsize=f.maxsize>0?String(f.maxsize).match(/[0-9]+/gi)[0]:-1);f.maxfile=f.maxfile>0?f.maxfile:null||u.E.data("maxfile")||0;f.maxfile>0||(f.maxfile=(String(u.e.className.match(/\b(maxfile|filemax)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],f.maxfile=f.maxfile>0?String(f.maxfile).match(/[0-9]+/gi)[0]:-1);f.maxfile>1&&(f.maxfile=f.maxfile*1024);f.maxsize>1&&(f.maxsize=f.maxsize*1024);f.max>1&&u.E.attr("multiple","multiple").prop("multiple",!0);n.extend(u,f||{});u.STRING=n.extend({},n.fn.MultiFile.options.STRING,u.STRING);n.extend(u,{n:0,slaves:[],files:[],instanceKey:u.e.id||"MultiFile"+String(e),generateID:function(n){return u.instanceKey+(n>0?"_F"+String(n):"")},trigger:function(t,r,u,f){var e,o=u[t]||u["on"+t];if(o)return f=f||u.files||i(this),n.each(f,function(n,t){e=o.apply(u.wrapper,[r,t.name,u,t])}),e}});String(u.accept).length>1&&(u.accept=u.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,""),u.rxAccept=new RegExp("\\.("+(u.accept?u.accept:"")+")$","gi"));u.wrapID=u.instanceKey;u.E.wrap('<div class="MultiFile-wrap" id="'+u.wrapID+'"><\/div>');u.wrapper=n("#"+u.wrapID+"");u.e.name=u.e.name||"file"+e+"[]";u.list||(u.wrapper.append('<div class="MultiFile-list" id="'+u.wrapID+'_list"><\/div>'),u.list=n("#"+u.wrapID+"_list"));u.list=n(u.list);u.addSlave=function(r,f){u.n++;r.MultiFile=u;r.id=r.name="";r.id=u.generateID(f);r.name=String(u.namePattern.replace(/\$name/gi,n(u.clone).attr("name")).replace(/\$id/gi,n(u.clone).attr("id")).replace(/\$g/gi,e).replace(/\$i/gi,f));var o;u.max>0&&u.files.length>u.max&&(r.disabled=!0,o=!0);u.current=r;r=n(r);r.val("").attr("value","")[0].value="";r.addClass("MultiFile-applied");r.change(function(){var c;if(this.value){n(this).blur();var v=this,l=u.files||[],s=this.files||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],o=[],a=0,h=u.total_size||0,e=[];if(n.each(s,function(n,t){o[o.length]=t}),u.trigger("FileSelect",this,u,o),n.each(s,function(r,f){var o=f.name,c=f.size,s=function(n){return n.replace("$ext",String(o.match(/[^\.]+$/i)||"")).replace("$file",o.match(/[^\/\\]+$/gi)).replace("$size",t(c)+" > "+t(u.maxfile))},h;u.accept&&o&&!o.match(u.rxAccept)&&(e[e.length]=s(u.STRING.denied),u.trigger("FileInvalid",this,u,[f]));n(u.wrapper).find("input[type=file]").not(v).each(function(){n.each(i(this),function(n,t){if(t.name){var i=(t.name||"").replace(/^C:\\fakepath\\/gi,"");(o==i||o==i.substr(i.length-o.length))&&(e[e.length]=s(u.STRING.duplicate),u.trigger("FileDuplicate",v,u,[t]))}})});u.maxfile>0&&c>0&&c>u.maxfile&&(e[e.length]=s(u.STRING.toobig),u.trigger("FileTooBig",this,u,[f]));h=u.trigger("FileValidate",this,u,[f]);h&&h!=""&&(e[e.length]=s(h));a+=f.size}),h+=a,o.size=a,o.total=h,o.total_length=o.length+l.length,u.max>0&&l.length+s.length>u.max&&(e[e.length]=u.STRING.toomany.replace("$max",u.max),u.trigger("FileTooMany",this,u,o)),u.maxsize>0&&h>u.maxsize&&(e[e.length]=u.STRING.toomuch.replace("$size",t(h)+" > "+t(u.maxsize)),u.trigger("FileTooMuch",this,u,o)),c=n(u.clone).clone(),c.addClass("MultiFile"),e.length>0)return u.error(e.join("\n\n")),u.n--,u.addSlave(c[0],f),r.parent().prepend(c),r.remove(),!1;u.total_size=h;s=l.concat(o);s.size=h;s.size_label=t(h);u.files=s;n(this).css({position:"absolute",top:"-3000px"});r.after(c);u.addSlave(c[0],f+1);u.addToList(this,f,o);u.trigger("afterFileSelect",this,u,o)}});n(r).data("MultiFile-wrap",u.wrapper);n(u.wrapper).data("MultiFile",u);o&&n(r).attr("disabled","disabled").prop("disabled",!0)};u.addToList=function(r,f,e){var o,s,h;u.trigger("FileAppend",r,u,e);o=n("<span/>");n.each(e,function(i,f){var e=String(f.name||""),s=u.STRING,l=s.label||s.file||s.name,a=s.title||s.tooltip||s.selected,h='<img class="MultiFile-preview" style="'+u.previewCss+'"/>',c=n(('<span class="MultiFile-label" title="'+a+'"><span class="MultiFile-title">'+l+"<\/span>"+(u.preview||n(r).is(".with-preview")?h:"")+"<\/span>").replace(/\$(file|name)/gi,(e.match(/[^\/\\]+$/gi)||[e])[0]).replace(/\$(ext|extension|type)/gi,(e.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,t(f.size||0)).replace(/\$(preview)/gi,h).replace(/\$(i)/gi,i));c.find("img.MultiFile-preview").each(function(){var t=this,n=new FileReader;n.readAsDataURL(f);n.onload=function(n){t.src=n.target.result}});i>1&&o.append(", ");o.append(c);e=String(f.name||"");o[o.length]=('<span class="MultiFile-title" title="'+u.STRING.selected+'">'+u.STRING.file+"<\/span>").replace(/\$(file|name)/gi,(e.match(/[^\/\\]+$/gi)||[e])[0]).replace(/\$(ext|extension|type)/gi,(e.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,t(f.size||0)).replace(/\$(i)/gi,i)});s=n('<div class="MultiFile-label" style="margin-top:5px;padding:1px;"><\/div>');h=n('<a class="MultiFile-remove" href="#'+u.wrapID+'" style="background-color:#d21c1c; font-size:14px; color:#fff; padding:4px 9px;">'+u.STRING.remove+"<\/a>").click(function(){var o=i(r),f,e;return u.trigger("FileRemove",r,u,o),u.n--,u.current.disabled=!1,n(r).remove(),n(this).parent().remove(),n(u.current).css({position:"",top:""}),n(u.current).reset().val("").attr("value","")[0].value="",f=[],e=0,n(u.wrapper).find("input[type=file]").each(function(){n.each(i(this),function(n,t){t.name&&(f[f.length]=t,e+=t.size)})}),u.files=f,u.total_size=e,u.size_label=t(e),n(u.wrapper).data("MultiFile",u),u.trigger("afterFileRemove",r,u,o),u.trigger("FileChange",u.current,u,f),!1});u.list.append(s.append(h," ",o));u.trigger("afterFileAppend",r,u,e);u.trigger("FileChange",r,u,u.files)};u.MultiFile||u.addSlave(u.e,0);u.n++})};n.extend(n.fn.MultiFile,{data:function(){var t=n(this),u=t.is(".MultiFile-wrap"),i=u?t:t.data("MultiFile-wrap"),r;return!i||!i.length?!console.error("Could not find MultiFile control wrapper"):(r=i.data("MultiFile"),!r)?!console.error("Could not find MultiFile data in wrapper"):r||{}},reset:function(){var t=this.MultiFile("data");return t&&n(t.list).find("a.MultiFile-remove").click(),n(this)},files:function(){var n=this.MultiFile("data");return n?n.files||[]:!console.log("MultiFile plugin not initialized")},size:function(){var n=this.MultiFile("data");return n?n.total_size||0:!console.log("MultiFile plugin not initialized")},count:function(){var n=this.MultiFile("data");return n?n.files?n.files.length||0:0:!console.log("MultiFile plugin not initialized")},disableEmpty:function(t){t=(typeof t=="string"?t:"")||"mfD";var i=[];return n("input:file.MultiFile").each(function(){n(this).val()==""&&(i[i.length]=this)}),window.clearTimeout(n.fn.MultiFile.reEnableTimeout),n.fn.MultiFile.reEnableTimeout=window.setTimeout(n.fn.MultiFile.reEnableEmpty,500),n(i).each(function(){this.disabled=!0}).addClass(t)},reEnableEmpty:function(t){return t=(typeof t=="string"?t:"")||"mfD",n("input:file."+t).removeClass(t).each(function(){this.disabled=!1})},intercepted:{},intercept:function(t,i,r){var e,u,f;if(r=r||[],r.constructor.toString().indexOf("Array")<0&&(r=[r]),typeof t=="function")return n.fn.MultiFile.disableEmpty(),u=t.apply(i||window,r),setTimeout(function(){n.fn.MultiFile.reEnableEmpty()},1e3),u;for(t.constructor.toString().indexOf("Array")<0&&(t=[t]),f=0;f<t.length;f++)e=t[f]+"",e&&function(t){n.fn.MultiFile.intercepted[t]=n.fn[t]||function(){};n.fn[t]=function(){return n.fn.MultiFile.disableEmpty(),u=n.fn.MultiFile.intercepted[t].apply(this,arguments),setTimeout(function(){n.fn.MultiFile.reEnableEmpty()},1e3),u}}(e)}});n.fn.MultiFile.options={accept:"",max:-1,maxfile:-1,maxsize:-1,namePattern:"$name",preview:!1,previewCss:"max-height:100px; max-width:100px;",STRING:{remove:"x",denied:"You cannot select a $ext file.\nTry again...",file:"$file",selected:"File selected: $file",duplicate:"This file has already been selected:\n$file",toomuch:"The files selected exceed the maximum size permited ($size)",toomany:"Too many files selected (max: $max)",toobig:"$file is too big (max $size)"},autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(n){typeof console!="undefined"&&console.log(n);alert(n)}};n.fn.reset=n.fn.reset||function(){return this.each(function(){try{this.reset()}catch(n){}})};n(function(){})}(jQuery);
/*
//# sourceMappingURL=jquery.MultiFile.min.js.map
*/